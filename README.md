# 谁是卧底 · 在线版

一个使用 **Node.js + Express + WebSocket** 实现的在线"谁是卧底"网页小游戏，支持多人实时聊天、轮流发言、在线投票，数据通过本地 JSON 文件持久化。

## 功能特性

- **房间系统** — 创建房间后分享房间号，好友输入即可加入
- **房主管理** — 房主可开始游戏、更换词语、调整卧底人数（1~3人）、踢出玩家
- **随机词语分配** — 从词库随机抽取词语对，平民和卧底各拿到不同的词
- **轮流发言** — 随机发言顺序，发送消息后自动轮到下一位
- **在线投票** — 实时显示每位玩家的投票进度（投票中 / 已投票）
- **胜负判定** — 所有卧底出局则平民胜，卧底人数 ≥ 平民则卧底胜
- **结算面板** — 游戏结束时揭晓词语，展示每位玩家的身份与对应词语
- **再来一局** — 房主一键重开，保留房间和玩家

## 技术栈

| 层 | 技术 |
|---|---|
| 后端 | Express + WebSocket (ws) |
| 前端 | React 18 + Tailwind CSS (CDN, 单文件) |
| ID 生成 | uuid |
| 数据存储 | 本地 JSON 文件 |

## 目录结构

```
├── server.js          # 后端服务
├── public/
│   └── index.html     # 前端（单文件 React 应用）
├── words.json         # 词语对配置
├── data/
│   └── games.json     # 游戏数据持久化（自动生成）
├── package.json
└── README.md
```

## 快速开始

```bash
# 安装依赖
yarn install   # 或 npm install

# 启动服务
yarn start     # 或 npm start
```

浏览器打开 `http://localhost:4444`，端口可通过环境变量 `PORT` 修改。

## 游戏流程

1. 输入昵称，创建或加入房间
2. 房主点击「更换词语」分配词语，再点击「开始游戏」
3. 按随机顺序轮流发言，描述自己的词语
4. 全员发言结束后进入投票，票数最高者出局（平票则无人出局）
5. 循环发言→投票，直到满足胜负条件
6. 结算弹窗揭晓所有玩家身份，房主可点击「再来一局」

## 词语配置

编辑 `words.json`，格式：

```json
[
  { "common": "苹果", "undercover": "梨" },
  { "common": "咖啡", "undercover": "奶茶" }
]
```

修改后重启服务即可生效。

## 数据存储

游戏数据保存在 `data/games.json`，服务重启后自动加载。删除该文件可重置所有数据。

## License

MIT
