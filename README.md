# 谁是卧底 · Node.js 在线版

一个使用 **Node.js + Express + WebSocket** 实现的在线"谁是卧底"网页小游戏，支持多人实时聊天、轮流发言、在线投票，数据通过本地 JSON 文件持久化。

## 目录结构

```text
whois/
├── server.js          # 后端服务（Express + WebSocket）
├── public/
│   └── index.html     # 前端页面（单文件，含 HTML + JS）
├── words.json         # 词语对配置文件
├── data/
│   └── games.json     # 游戏数据持久化（自动生成）
├── package.json
└── yarn.lock
```

## 功能概要

- **创建 / 加入房间**：房主创建房间后分享房间号，其他玩家输入房间号加入
- **房主机制**：第一个加入的玩家自动成为房主，房主离开后自动顺延
- **随机词语分配**：房主点击"更换词语"从词库随机抽取词语对，并直接分配给所有玩家
- **轮流发言**：游戏开始后按随机顺序轮流发言，发送消息后自动结束本轮发言
- **在线投票**：发言结束后进入投票阶段，所有存活玩家各投一票，票数最高者出局
- **胜负判定**：
  - 所有卧底被淘汰 → 平民胜利
  - 卧底人数 ≥ 平民人数 → 卧底胜利
- **词语揭晓**：游戏结束时系统自动公布平民词和卧底词
- **重新开始**：游戏结束后房主可直接点击"更换词语"开始新一局

## 运行环境

- Node.js >= 16
- 操作系统：macOS / Linux / Windows 均可

## 安装与启动

```bash
# 安装依赖
yarn install   # 或 npm install

# 启动服务器
yarn start     # 或 npm start
```

服务默认在 `http://localhost:4444` 启动（端口可通过环境变量 `PORT` 修改）。

## 游戏玩法

1. **创建房间**：输入昵称，点击"创建房间（随机词语）"，系统生成房间号
2. **邀请玩家**：将房间号分享给其他玩家，他们输入昵称和房间号后点击"加入房间"
3. **分配词语**：房主点击"更换词语"，系统从词库随机抽取一组词语对，分配给所有玩家（每人只能看到自己的词）
4. **开始游戏**：至少 3 名玩家时，房主点击"开始游戏"
5. **轮流发言**：系统随机确定发言顺序，轮到的玩家发送一条消息描述自己的词语，发送后自动轮到下一位
6. **投票淘汰**：所有人发言结束后进入投票阶段，每人投一票，票数最高者出局
7. **游戏结束**：满足胜负条件时游戏结束，系统揭晓词语

## 词语配置

词语对存储在项目根目录的 `words.json` 文件中，格式如下：

```json
[
  { "common": "苹果", "undercover": "香蕉" },
  { "common": "咖啡", "undercover": "奶茶" }
]
```

- `common`：平民词
- `undercover`：卧底词

可自由增删词语对，修改后重启服务器即可生效。

## 技术栈

| 组件 | 技术 |
|------|------|
| 后端框架 | Express |
| 实时通信 | WebSocket (ws) |
| ID 生成 | uuid |
| 前端样式 | Tailwind CSS (CDN) |
| 数据存储 | 本地 JSON 文件 |

## 数据存储

- 游戏数据保存在 `data/games.json`，重启服务器后自动加载
- 如需重置所有数据，删除 `data/games.json` 即可（服务器会自动重建）
