## 谁是卧底 · Node.js 在线版

一个使用 **Node.js + Express + WebSocket** 实现的简易“谁是卧底”网页小游戏，数据通过写入本地 JSON 文件来持久化。

### 功能概要

- **创建房间**：设置“平民词 / 卧底词”，生成一个房间号。
- **加入房间**：玩家输入房间号和昵称加入。
- **在线聊天**：同一房间内玩家可以实时聊天。
- **在线投票**：每轮所有存活玩家都投出一票，票数最高的玩家出局。
- **胜负判定**：
  - 所有卧底被淘汰 → 平民胜利。
  - 卧底人数 ≥ 平民人数 → 卧底胜利。
- **文件数据库**：所有房间状态保存在 `data/games.json` 中。

### 运行环境

- Node.js ≥ 16
- 操作系统：macOS / Linux / Windows 均可

### 安装依赖

在项目根目录（包含 `package.json` 的目录）执行：

```bash
npm install
```

这会安装：

- `express`：HTTP 服务与静态资源
- `ws`：WebSocket 实时通信
- `uuid`：生成房间、玩家和消息 ID

### 启动服务器

```bash
npm start
```

默认会在 `http://localhost:3000` 启动服务。

开发模式（仅打印更多日志的话可以用）：

```bash
npm run dev
```

### 游戏入口

- 浏览器打开：`http://localhost:3000`
- 前端文件位于：`public/index.html`
- 后端逻辑位于：`server.js`

### 基本玩法说明

1. **输入昵称**
   - 页面左上角“昵称”输入框中填写自己的名字。

2. **创建房间**
   - 在“平民词 / 卧底词”中分别填入两个相近的词，例如：
     - 平民词：`苹果`
     - 卧底词：`香蕉`
   - 点击“创建房间”：
     - 右上角会显示“房间号”。
     - 自己自动加入该房间。

3. **邀请其他玩家**
   - 把“房间号”发给其他玩家。
   - 其他玩家在“昵称”中输入名字，在“加入已有房间”中填写该房间号，点击“加入房间”。

4. **开始游戏**
   - 至少 3 名玩家在房间时，“开始游戏”按钮会变为可用。
   - 点击“开始游戏”：
     - 系统为所有玩家随机分配“平民 / 卧底”身份。
     - 每个玩家的词语会显示在左侧“你的词语”区域，只有自己可见。

5. **发言 & 聊天**
   - 玩家可以轮流描述自己的词语特征。
   - 也可以在右侧聊天输入框中打字交流。

6. **投票**
   - 在“玩家 / 投票”区域，每个存活玩家旁边有“投票”按钮。
   - 在一轮讨论后，所有存活玩家各给出一票：
     - 票数最高的玩家会被淘汰（系统消息会提示）。
     - 游戏自动进入下一轮。

7. **游戏结束**
   - 游戏中任一轮投票后满足以下条件之一则结束：
     - 所有卧底出局 → 平民获胜。
     - 卧底人数 ≥ 平民人数 → 卧底获胜。
   - 结果会以系统消息的形式显示在聊天中。

### 数据存储说明

- 所有房间与玩家信息会写入 `data/games.json`。
- 重启服务器后，历史房间信息仍会从该文件中加载（简单持久化）。
- 如果想重置所有游戏数据，直接删除 `data/games.json` 文件即可（服务器会重新创建一个空文件）。

### 简单自测方法

1. 启动服务器：`npm start`
2. 打开多个浏览器标签页，都访问 `http://localhost:3000`
3. 使用不同昵称：
   - 第一个标签页创建房间。
   - 其他标签页通过房间号加入。
4. 依次测试：
   - 聊天是否实时同步。
   - 开始游戏后，词语是否正确、只对各自可见。
   - 投票后是否有玩家被淘汰、是否能自动进入下一轮。

如需扩展（例如：房主身份、多个房间管理、更多配置等），可以在 `server.js` 中继续增加逻辑。这里只是一个简洁可运行的基础版本。

